# 希尔排序

对于插入排序而言，如果拿到的是一个较小的数，那么元素后移的次数会明显增加，严重影响整个排序的效率。

希尔排序，也称递减增量排序，是插入排序的一种更高效的改进版本。

插入排序**对已经有序的或者是有序程度高的序列排序是非常快的**，但一般情况下，由于插入排序每插入一个元素都只能一个一个元素地进行移动，因此它的效率是十分低下的。

> 希尔排序的思路：尽可能的在数组进行下一轮的排序时，提高数组的有序程度。

**在序列的排序中，元素越少，需要交换的次数越少，排序越快。**

利用（索引）增量，将序列分割成若干个子序列，再将每个子序列分别排好，从而提高一个数组的有序程度。

> 增量就是一个等差数列的差值，比如 1, 3, 5, 7, 9 它们的增量是 2。

一开始尽可能使用一个大的增量，使得每个子序列中的元素少，比如第一轮就尽量使得一个子序列的元素只有两个。

增量越大，那么分的组就会越多，每个组中的元素数目就会小。每一轮都比上一轮的增量按照一定的规律递减，那么分的组就会比上一轮的分的组少，而每个组中的元素就要比上一轮的元素要多，当增量一直减到 1 的时候，就会发现只有一个组了，而这个组中的元素就是整个序列的所有元素，这就是递减增量。

> 增量每一次发生递减，那么序列的有序程度就提高了那么一点，当增量递减到 1 的时候，序列的有序程度就已经很高的，这时再进行一轮插入排序，就很快了。

以 8 9 1 7 2 3 5 4 6 0 一共 10 个数为例，选择增量为 gap = 10 / 2，以缩小增量为 gap = gap / 2 的方式：

- 初始增量为 gap = 10 / 2 = 5，整个数组分成了 5 组
按颜色划分为【 8 , 3 】，【 9 , 5 】，【 1 , 4 】，【 7 , 6 】，【 2 , 0 】
- 对这分开的 5 组，分别使用插入排序，结果为 3 5 1 6 0 8 9 4 7 2
- 缩小增量 gap = 5 / 2 = 2，整个数组分成了 2 组 【 3 , 1 , 0 , 9 , 7  】，【 5 , 6 , 8 , 4 , 2  】
- 对这分开的 2 组分别使用插入排序，结果为 0 2 1 4 3 5 7 6 9 8
- 再缩小增量 gap = 2 / 2 = 1，整个数组分成了 1 组
【 0, 2 , 1 , 4 , 3 , 5 , 7 , 6 , 9 , 8 】
- 此时，只需要对以上数列进行简单的微调，不需要大量的移动操作即可完成整个数组的排序

```ts
function shellSort(nums: number[]): number[] {
    const len = nums.length
    for (let gap = len >> 1; gap > 0; gap = gap >> 1) {
        for (let i = gap; i < len; i++) {
            let j = i;
            let current = nums[i];
            // 插入排序
            // 通过 while 形成了一个“队列”
            while(j - gap >= 0 && current < nums[j - gap]) {
                nums[j] = nums[j - gap];
                j = j - gap;
            }
            nums[j] = current;
        }
    }

    return nums;
}
```
